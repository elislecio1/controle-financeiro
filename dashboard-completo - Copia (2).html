<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Financeiro - Google Sheets</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="config.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f9fafb;
            color: #374151;
        }

        .header {
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border-bottom: 1px solid #e5e7eb;
            padding: 1rem 0;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: #1f2937;
        }

        .logo-icon {
            width: 2rem;
            height: 2rem;
            background: #3b82f6;
            border-radius: 0.5rem;
            margin-right: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .buttons {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .nav {
            background: white;
            border-bottom: 1px solid #e5e7eb;
        }

        .nav-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .nav-tabs {
            display: flex;
            gap: 2rem;
        }

        .nav-tab {
            padding: 1rem 0;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            font-weight: 500;
            color: #6b7280;
            transition: all 0.2s;
        }

        .nav-tab.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }

        .nav-tab:hover {
            color: #374151;
        }

        .main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border-radius: 0.5rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: all 0.2s;
            cursor: pointer;
        }

        .stat-card:hover {
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .stat-card.active {
            border: 2px solid #3b82f6;
            background: #f0f9ff;
        }

        .stat-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .stat-icon {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
        }

        .stat-value {
            font-size: 1.875rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #6b7280;
            font-size: 0.875rem;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .chart-container {
            background: white;
            border-radius: 0.5rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            height: 400px; /* Altura fixa para propor√ß√£o consistente */
            position: relative;
        }

        .chart-container canvas {
            max-height: 320px; /* Altura m√°xima para o canvas */
            width: 100% !important;
            height: 100% !important;
        }

        .chart-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #1f2937;
        }

        .data-table {
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .table-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .table-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: #f9fafb;
            padding: 0.75rem 1rem;
            text-align: left;
            font-weight: 500;
            color: #6b7280;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .table tr:hover {
            background: #f9fafb;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-pago {
            background: #dcfce7;
            color: #166534;
        }

        .status-pendente {
            background: #fef3c7;
            color: #92400e;
        }

        .status-vencido {
            background: #fee2e2;
            color: #991b1b;
        }

        .valor-negativo {
            color: #dc2626;
            font-weight: 600;
        }

        .valor-positivo {
            color: #059669;
            font-weight: 600;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            color: #6b7280;
        }

        .spinner {
            width: 1.5rem;
            height: 1.5rem;
            border: 2px solid #e5e7eb;
            border-top: 2px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 0.5rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #fee2e2;
            color: #991b1b;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
        }

        .success {
            background: #dcfce7;
            color: #166534;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
        }

        /* Filtros de Per√≠odo */
        .period-filters {
            background: white;
            border-radius: 0.5rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
        }

        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .filter-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
        }

        .filter-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            background: white;
            color: #374151;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .filter-btn:hover {
            background: #f3f4f6;
        }

        .custom-period {
            margin-top: 1rem;
            padding: 1rem;
            background: #f9fafb;
            border-radius: 0.375rem;
        }

        .date-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 1rem;
            align-items: end;
        }

        .date-input {
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }

        /* Pagina√ß√£o */
        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            border-top: 1px solid #e5e7eb;
        }

        .pagination-info {
            color: #6b7280;
            font-size: 0.875rem;
        }

        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .page-btn {
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            background: white;
            color: #374151;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 0.875rem;
        }

        .page-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Indicadores de ordena√ß√£o */
        .sort-indicator {
            font-size: 0.75rem;
            margin-left: 0.25rem;
            color: #6b7280;
        }

        .sort-indicator.active {
            color: #3b82f6;
            font-weight: bold;
        }

        /* Hover nos cabe√ßalhos da tabela */
        .table th:hover {
            background: #f3f4f6;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-buttons {
                grid-template-columns: 1fr;
            }
            
            .date-inputs {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">üìä</div>
                Dashboard Financeiro
            </div>
            <div class="buttons">
                <button class="btn btn-success" onclick="testConnection()">
                    üß™ Testar Conex√£o
                </button>
                <button class="btn btn-primary" onclick="loadData()">
                    üîÑ Atualizar
                </button>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-content">
            <div class="nav-tabs">
                <div class="nav-tab active" onclick="showTab('geral')">üìã Geral</div>
                <div class="nav-tab" onclick="showTab('overview')">üìà Vis√£o Geral</div>
                <div class="nav-tab" onclick="showTab('analytics')">üìä An√°lises</div>
                <div class="nav-tab" onclick="showTab('reports')">üìÑ Relat√≥rios</div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main">
        <div id="loading" class="loading" style="display: none;">
            <div class="spinner"></div>
            Carregando dados...
        </div>

        <div id="error" class="error" style="display: none;"></div>
        <div id="success" class="success" style="display: none;"></div>

        <!-- Geral Tab -->
        <div id="geral" class="tab-content">
            <!-- Filtros de Per√≠odo -->
            <div class="period-filters">
                <div class="filter-header">
                    <h3 class="filter-title">Filtros de Per√≠odo</h3>
                    <div>
                        <span id="filter-count" class="text-sm text-gray-500">0 registros</span>
                        <button onclick="clearFilters()" class="btn btn-primary" style="margin-left: 1rem;">
                            üóëÔ∏è Limpar Filtros
                        </button>
                    </div>
                </div>
                
                <div class="filter-buttons">
                    <button class="filter-btn active" onclick="applyPeriodFilter('all')">üìÖ Todos os Per√≠odos</button>
                    <button class="filter-btn" onclick="applyPeriodFilter('current-month')">üìÖ M√™s Atual</button>
                    <button class="filter-btn" onclick="applyPeriodFilter('previous-month')">üìÖ M√™s Anterior</button>
                    <button class="filter-btn" onclick="applyPeriodFilter('current-year')">üìÖ Ano Atual</button>
                </div>
                
                <div class="custom-period">
                    <button class="filter-btn" onclick="toggleCustomPeriod()">üîç Per√≠odo Customizado</button>
                    <div id="custom-period-inputs" style="display: none; margin-top: 1rem;">
                        <div class="date-inputs">
                            <input type="text" id="start-date" class="date-input" placeholder="Data Inicial (DD/MM/AAAA)">
                            <input type="text" id="end-date" class="date-input" placeholder="Data Final (DD/MM/AAAA)">
                            <button class="btn btn-primary" onclick="applyCustomPeriodFilter()">Aplicar</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card" onclick="applyFilter('pago')">
                    <div class="stat-header">
                        <div class="stat-icon" style="background: #10b981;">üí∞</div>
                        <div>
                            <div class="stat-value" id="total-pago">R$ 0</div>
                            <div class="stat-label">Total Pago</div>
                        </div>
                    </div>
                </div>

                <div class="stat-card" onclick="applyFilter('pendente')">
                    <div class="stat-header">
                        <div class="stat-icon" style="background: #f59e0b;">‚è≥</div>
                        <div>
                            <div class="stat-value" id="total-pendente">R$ 0</div>
                            <div class="stat-label">Total Pendente</div>
                        </div>
                    </div>
                </div>

                <div class="stat-card" onclick="applyFilter('vencido')">
                    <div class="stat-header">
                        <div class="stat-icon" style="background: #ef4444;">‚ö†Ô∏è</div>
                        <div>
                            <div class="stat-value" id="total-vencido">R$ 0</div>
                            <div class="stat-label">Total Vencido</div>
                        </div>
                    </div>
                </div>

                <div class="stat-card" onclick="applyFilter('pago-hoje')">
                    <div class="stat-header">
                        <div class="stat-icon" style="background: #3b82f6;">üìÖ</div>
                        <div>
                            <div class="stat-value" id="total-pago-hoje">R$ 0</div>
                            <div class="stat-label">Pago Hoje</div>
                        </div>
                    </div>
                </div>

                <div class="stat-card" onclick="applyFilter('vencendo-hoje')">
                    <div class="stat-header">
                        <div class="stat-icon" style="background: #f97316;">üö®</div>
                        <div>
                            <div class="stat-value" id="total-vencendo-hoje">R$ 0</div>
                            <div class="stat-label">Vencendo Hoje</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cards de Receitas Detalhadas -->
            <div class="stats-grid">
                <div class="stat-card" onclick="applyFilter('a-receber-hoje')">
                    <div class="stat-header">
                        <div class="stat-icon" style="background: #059669;">üìÖ</div>
                        <div>
                            <div class="stat-value" id="a-receber-hoje">R$ 0</div>
                            <div class="stat-label">A Receber Hoje</div>
                        </div>
                    </div>
                </div>

                <div class="stat-card" onclick="applyFilter('a-receber')">
                    <div class="stat-header">
                        <div class="stat-icon" style="background: #f59e0b;">‚è≥</div>
                        <div>
                            <div class="stat-value" id="a-receber">R$ 0</div>
                            <div class="stat-label">A Receber</div>
                        </div>
                    </div>
                </div>

                <div class="stat-card" onclick="applyFilter('total-a-receber')">
                    <div class="stat-header">
                        <div class="stat-icon" style="background: #dc2626;">üìã</div>
                        <div>
                            <div class="stat-value" id="total-a-receber">R$ 0</div>
                            <div class="stat-label">Total a Receber</div>
                        </div>
                    </div>
                </div>

                <div class="stat-card" onclick="applyFilter('total-recebido')">
                    <div class="stat-header">
                        <div class="stat-icon" style="background: #10b981;">‚úÖ</div>
                        <div>
                            <div class="stat-value" id="total-recebido">R$ 0</div>
                            <div class="stat-label">Total Recebido</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cards de Despesas e Receitas -->
            <div class="stats-grid">
                <div class="stat-card" onclick="applyFilter('despesas')">
                    <div class="stat-header">
                        <div class="stat-icon" style="background: #dc2626;">üí∏</div>
                        <div>
                            <div class="stat-value" id="total-despesas">R$ 0</div>
                            <div class="stat-label">Total de Despesas</div>
                        </div>
                    </div>
                </div>

                <div class="stat-card" onclick="applyFilter('receitas')">
                    <div class="stat-header">
                        <div class="stat-icon" style="background: #059669;">üíµ</div>
                        <div>
                            <div class="stat-value" id="total-receitas">R$ 0</div>
                            <div class="stat-label">Total de Receitas</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Resultado Financeiro -->
            <div class="stat-card" style="margin-bottom: 2rem;">
                <div class="stat-header">
                    <div class="stat-icon" style="background: #3b82f6;">üìä</div>
                    <div>
                        <div class="stat-value" id="total-geral">R$ 0</div>
                        <div class="stat-label">Resultado Financeiro</div>
                    </div>
                </div>
            </div>

            <!-- Charts -->
            <div class="charts-grid">
                <div class="chart-container">
                    <h3 class="chart-title">Evolu√ß√£o por Status</h3>
                    <canvas id="lineChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3 class="chart-title">Distribui√ß√£o por Status</h3>
                    <canvas id="pieChart"></canvas>
                </div>
            </div>

            <!-- Data Table -->
            <div class="data-table">
                <div class="table-header">
                    <h3 class="table-title">Transa√ß√µes</h3>
                </div>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th onclick="sortTable('vencimento')" style="cursor: pointer;">
                                    Vencimento 
                                    <span id="sort-vencimento" class="sort-indicator">‚Üï</span>
                                </th>
                                <th onclick="sortTable('descricao')" style="cursor: pointer;">
                                    Descri√ß√£o 
                                    <span id="sort-descricao" class="sort-indicator">‚Üï</span>
                                </th>
                                <th onclick="sortTable('empresa')" style="cursor: pointer;">
                                    Empresa 
                                    <span id="sort-empresa" class="sort-indicator">‚Üï</span>
                                </th>
                                <th onclick="sortTable('valor')" style="cursor: pointer;">
                                    Valor 
                                    <span id="sort-valor" class="sort-indicator">‚Üï</span>
                                </th>
                                <th onclick="sortTable('status')" style="cursor: pointer;">
                                    Status 
                                    <span id="sort-status" class="sort-indicator">‚Üï</span>
                                </th>
                                <th onclick="sortTable('dataPagamento')" style="cursor: pointer;">
                                    Data Pagamento 
                                    <span id="sort-dataPagamento" class="sort-indicator">‚Üï</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="data-table-body">
                            <!-- Dados ser√£o inseridos aqui -->
                        </tbody>
                    </table>
                </div>
                <div class="pagination" id="pagination" style="display: none;">
                    <div class="pagination-info" id="pagination-info">
                        Mostrando 0-0 de 0 registros
                    </div>
                    <div class="pagination-controls" id="pagination-controls">
                        <!-- Controles de pagina√ß√£o -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Outras abas ser√£o adicionadas aqui -->
    </main>

    <script>
        // Configura√ß√µes do Google Sheets
        const GOOGLE_SHEETS_API_KEY = CONFIG.GOOGLE_SHEETS_API_KEY;
        const SPREADSHEETS_ID = CONFIG.SPREADSHEETS_ID;
        const SHEET_NAME = CONFIG.SHEET_NAME;
        const CORS_PROXY = CONFIG.CORS_PROXY;
        const API_TIMEOUT = CONFIG.TIMEOUT;
        
        // Estado da aplica√ß√£o
        let allData = [];
        let filteredData = [];
        let currentFilter = null;
        let currentPeriodFilter = 'all';
        let currentPage = 1;
        const itemsPerPage = CONFIG.ITEMS_PER_PAGE;
        let sortBy = 'vencimento'; // Campo para ordena√ß√£o
        let sortOrder = 'asc'; // Ordem da ordena√ß√£o
        
        // Charts
        let lineChart = null;
        let pieChart = null;
        
        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            // Inicializa indicador de ordena√ß√£o padr√£o
            const defaultIndicator = document.getElementById('sort-vencimento');
            if (defaultIndicator) {
                defaultIndicator.classList.add('active');
                defaultIndicator.textContent = '‚Üë';
            }
        });

        // Fun√ß√£o para carregar dados do Google Sheets
        async function loadData() {
            showLoading(true);
            hideMessages();
            
            try {
                console.log('üîç Conectando com Google Sheets...');
                console.log('üìä Spreadsheet ID:', SPREADSHEETS_ID);
                console.log('üîë API Key:', GOOGLE_SHEETS_API_KEY.substring(0, 10) + '...');
                
                // Lista de proxies CORS alternativos
                const corsProxies = [
                    'https://cors-anywhere.herokuapp.com/',
                    'https://api.allorigins.win/raw?url=',
                    'https://corsproxy.io/?',
                    'https://thingproxy.freeboard.io/fetch/'
                ];
                
                let response = null;
                let lastError = null;
                
                // Tenta primeiro sem proxy
                try {
                    const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEETS_ID}/values/${SHEET_NAME}!A:Z`;
                    console.log('üåê Tentativa 1 - URL direta:', url);
                    
                    response = await axios.get(url, {
                        params: {
                            key: GOOGLE_SHEETS_API_KEY,
                            majorDimension: 'ROWS',
                            _t: Date.now()
                        },
                        timeout: API_TIMEOUT
                    });
                } catch (error) {
                    console.log('‚ö†Ô∏è Erro na tentativa direta:', error.message);
                    lastError = error;
                    
                    // Tenta com diferentes proxies CORS
                    for (let i = 0; i < corsProxies.length; i++) {
                        try {
                            const proxy = corsProxies[i];
                            const url = `${proxy}https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEETS_ID}/values/${SHEET_NAME}!A:Z?key=${GOOGLE_SHEETS_API_KEY}&majorDimension=ROWS&_t=${Date.now()}`;
                            console.log(`üåê Tentativa ${i + 2} - Proxy ${i + 1}:`, proxy);
                            
                            response = await axios.get(url, {
                                timeout: API_TIMEOUT
                            });
                            console.log('‚úÖ Sucesso com proxy:', proxy);
                            break;
                        } catch (proxyError) {
                            console.log(`‚ùå Falha com proxy ${i + 1}:`, proxyError.message);
                            lastError = proxyError;
                        }
                    }
                }

                if (!response) {
                    throw new Error(`Falha em todas as tentativas. √öltimo erro: ${lastError?.message || 'Desconhecido'}`);
                }

                console.log('‚úÖ Resposta da API:', response.status, response.statusText);
                const rows = response.data.values || [];
                console.log('üìã Dados recebidos:', rows.length, 'linhas');
                
                if (rows.length === 0) {
                    console.log('‚ö†Ô∏è Planilha vazia, usando dados simulados');
                    allData = getMockData();
                } else {
                    allData = parseSheetData(rows);
                }
                
                filteredData = [...allData];
                updateUI();
                showSuccess('Dados carregados com sucesso!');
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar dados:', error);
                console.error('üìù Detalhes do erro:', {
                    message: error.message,
                    status: error.response?.status,
                    statusText: error.response?.statusText,
                    data: error.response?.data
                });
                
                // Verifica se √© erro 403 espec√≠fico
                if (error.response?.status === 403) {
                    showError('Erro 403: Verifique se a planilha est√° p√∫blica ou se a API key tem permiss√µes corretas. Usando dados simulados.');
                } else {
                    showError(`Erro ao carregar dados: ${error.message}. Usando dados simulados.`);
                }
                
                allData = getMockData();
                filteredData = [...allData];
                updateUI();
            } finally {
                showLoading(false);
            }
        }

        // Fun√ß√£o para testar conex√£o
        async function testConnection() {
            showLoading(true);
            hideMessages();
            
            try {
                console.log('üîç Testando conex√£o com Google Sheets...');
                console.log('üìä Spreadsheet ID:', SPREADSHEETS_ID);
                console.log('üîë API Key:', GOOGLE_SHEETS_API_KEY.substring(0, 10) + '...');
                
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEETS_ID}`;
                console.log('üåê URL da requisi√ß√£o:', url);
                
                const response = await axios.get(url, {
                    params: {
                        key: GOOGLE_SHEETS_API_KEY,
                        includeGridData: false
                    },
                    timeout: API_TIMEOUT
                });
                
                console.log('‚úÖ Resposta da API:', response.status, response.statusText);
                console.log('üìã Informa√ß√µes da planilha:', response.data);
                
                showSuccess('Conex√£o estabelecida com sucesso!');
                console.log('‚úÖ Conex√£o bem-sucedida!');
                
            } catch (error) {
                console.error('‚ùå Erro na conex√£o:', error);
                console.error('üìù Detalhes do erro:', {
                    message: error.message,
                    status: error.response?.status,
                    statusText: error.response?.statusText,
                    data: error.response?.data
                });
                
                let errorMessage = 'Erro desconhecido';
                
                if (error.response?.status === 403) {
                    errorMessage = 'Acesso negado. Verifique se a planilha est√° p√∫blica.';
                } else if (error.response?.status === 404) {
                    errorMessage = 'Planilha n√£o encontrada. Verifique o Spreadsheet ID.';
                } else if (error.response?.status === 400) {
                    errorMessage = 'API Key inv√°lida ou sem permiss√µes.';
                } else if (error.code === 'ECONNABORTED') {
                    errorMessage = 'Timeout na conex√£o. Verifique sua internet.';
                } else if (error.code === 'ERR_NETWORK') {
                    errorMessage = 'Erro de rede. Verifique sua conex√£o com a internet.';
                }
                
                showError(`${errorMessage} (${error.message})`);
            } finally {
                showLoading(false);
            }
        }

        // Fun√ß√£o para parsear dados da planilha
        function parseSheetData(rows) {
            const headers = rows[0] || [];
            const dataRows = rows.slice(1);
            
            console.log('üìù Cabe√ßalhos encontrados:', headers);
            
            // Mapeia as colunas
            const vencimentoIndex = headers.findIndex(h => 
                h.toLowerCase().includes('vencimento') || 
                h.toLowerCase().includes('data vencimento')
            );
            
            const descricaoIndex = headers.findIndex(h => 
                h.toLowerCase().includes('descri√ß√£o') || 
                h.toLowerCase().includes('descricao') ||
                h.toLowerCase().includes('desc')
            );
            
            const empresaIndex = headers.findIndex(h => 
                h.toLowerCase().includes('empresa') ||
                h.toLowerCase().includes('fornecedor') ||
                h.toLowerCase().includes('cliente')
            );
            
            const tipoIndex = headers.findIndex(h => 
                h.toLowerCase().includes('tipo') ||
                h.toLowerCase().includes('categoria')
            );
            
            const valorIndex = headers.findIndex(h => 
                h.toLowerCase().includes('valor') ||
                h.toLowerCase().includes('amount')
            );
            
            const parcelaIndex = headers.findIndex(h => 
                h.toLowerCase().includes('parcela') ||
                h.toLowerCase().includes('installment')
            );
            
            const situacaoIndex = headers.findIndex(h => 
                h.toLowerCase().includes('situa√ß√£o') || 
                h.toLowerCase().includes('situacao') ||
                h.toLowerCase().includes('status')
            );
            
            const dataPagamentoIndex = headers.findIndex(h => 
                h.toLowerCase().includes('data pagamento') || 
                h.toLowerCase().includes('data de pagamento') ||
                h.toLowerCase().includes('pagamento')
            );

            return dataRows
                .filter(row => {
                    return row && row.length > 0 && 
                           (row[vencimentoIndex] || row[descricaoIndex] || row[valorIndex]);
                })
                .map((row, index) => {
                    // Processa o valor
                    let valor = 0;
                    if (row[valorIndex]) {
                        const valorStr = row[valorIndex].toString();
                        valor = parseFloat(valorStr.replace(/\./g, '').replace(',', '.')) || 0;
                    }
                    
                    const situacao = row[situacaoIndex] || '';
                    const dataPagamento = row[dataPagamentoIndex] || '';
                    
                    // Determina o status
                    let status = 'pendente';
                    if (situacao.toLowerCase().includes('pago') || dataPagamento) {
                        status = 'pago';
                    } else if (row[vencimentoIndex]) {
                        try {
                            const vencimento = parseBrazilianDate(row[vencimentoIndex]);
                            const hoje = new Date();
                            if (vencimento && vencimento < hoje) {
                                status = 'vencido';
                            }
                        } catch (error) {
                            console.warn('‚ö†Ô∏è Erro ao processar data de vencimento:', row[vencimentoIndex]);
                        }
                    }

                    return {
                        id: (index + 1).toString(),
                        vencimento: row[vencimentoIndex] || '',
                        descricao: row[descricaoIndex] || '',
                        empresa: row[empresaIndex] || '',
                        tipo: row[tipoIndex] || '',
                        valor: valor,
                        parcela: row[parcelaIndex] || '',
                        situacao: situacao,
                        dataPagamento: dataPagamento,
                        status: status
                    };
                });
        }

        // Fun√ß√£o para converter data brasileira
        function parseBrazilianDate(dateStr) {
            if (!dateStr) return null;
            try {
                const parts = dateStr.split('/');
                if (parts.length === 3) {
                    return new Date(parseInt(parts[2]), parseInt(parts[1]) - 1, parseInt(parts[0]));
                }
            } catch (error) {
                console.warn('Erro ao processar data:', dateStr);
            }
            return null;
        }

        // Fun√ß√£o para verificar se uma data est√° dentro de um per√≠odo
        function isDateInPeriod(dateStr, startDate, endDate) {
            const date = parseBrazilianDate(dateStr);
            if (!date) return false;
            return date >= startDate && date <= endDate;
        }

        // Fun√ß√£o para obter per√≠odo baseado no filtro
        function getPeriodDates(period) {
            const hoje = new Date();
            const ano = hoje.getFullYear();
            const mes = hoje.getMonth();

            switch (period) {
                case 'current-month':
                    return {
                        start: new Date(ano, mes, 1),
                        end: new Date(ano, mes + 1, 0)
                    };
                case 'previous-month':
                    return {
                        start: new Date(ano, mes - 1, 1),
                        end: new Date(ano, mes, 0)
                    };
                case 'current-year':
                    return {
                        start: new Date(ano, 0, 1),
                        end: new Date(ano, 11, 31)
                    };
                default:
                    return null;
            }
        }

        // Fun√ß√£o para aplicar filtro de per√≠odo
        function applyPeriodFilter(period) {
            currentPeriodFilter = period;
            currentPage = 1;
            
            // Atualiza bot√µes de filtro
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            if (period === 'all') {
                filteredData = [...allData];
            } else {
                const periodDates = getPeriodDates(period);
                if (periodDates) {
                    filteredData = allData.filter(item => {
                        return isDateInPeriod(item.vencimento, periodDates.start, periodDates.end);
                    });
                }
            }
            
            updateUI();
        }

        // Fun√ß√£o para aplicar filtro customizado
        function applyCustomPeriodFilter() {
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;
            
            if (!startDate || !endDate) {
                showError('Por favor, preencha ambas as datas.');
                return;
            }
            
            const start = parseBrazilianDate(startDate);
            const end = parseBrazilianDate(endDate);
            
            if (!start || !end) {
                showError('Formato de data inv√°lido. Use DD/MM/AAAA.');
                return;
            }
            
            if (start > end) {
                showError('Data inicial deve ser menor que a data final.');
                return;
            }
            
            currentPeriodFilter = 'custom';
            currentPage = 1;
            
            filteredData = allData.filter(item => {
                return isDateInPeriod(item.vencimento, start, end);
            });
            
            updateUI();
            showSuccess('Filtro customizado aplicado!');
        }

        // Fun√ß√£o para aplicar filtro de status
        function applyFilter(filterType) {
            if (currentFilter === filterType) {
                currentFilter = null;
                filteredData = allData.filter(item => {
                    if (currentPeriodFilter !== 'all') {
                        const periodDates = getPeriodDates(currentPeriodFilter);
                        return periodDates ? isDateInPeriod(item.vencimento, periodDates.start, periodDates.end) : true;
                    }
                    return true;
                });
            } else {
                currentFilter = filterType;
                filteredData = allData.filter(item => {
                    let matchesFilter = false;
                    
                    switch (filterType) {
                        case 'pago':
                            matchesFilter = item.status === 'pago';
                            break;
                        case 'pendente':
                            matchesFilter = item.status === 'pendente';
                            break;
                        case 'vencido':
                            matchesFilter = item.status === 'vencido';
                            break;
                        case 'pago-hoje':
                            const hojeFormatada = new Date().toLocaleDateString('pt-BR');
                            matchesFilter = item.status === 'pago' && item.dataPagamento === hojeFormatada;
                            break;
                        case 'vencendo-hoje':
                            const vencimento = parseBrazilianDate(item.vencimento);
                            const hoje = new Date();
                            matchesFilter = item.tipo === 'D' && vencimento && vencimento.toDateString() === hoje.toDateString() && item.status !== 'pago';
                            break;
                        case 'despesas':
                            matchesFilter = item.tipo === 'D';
                            break;
                        case 'receitas':
                            matchesFilter = item.tipo === 'C';
                            break;
                        case 'a-receber-hoje':
                            const vencimentoHoje = parseBrazilianDate(item.vencimento);
                            const hojeReceber = new Date();
                            matchesFilter = item.tipo === 'C' && vencimentoHoje && vencimentoHoje.toDateString() === hojeReceber.toDateString() && item.status !== 'pago';
                            break;
                        case 'a-receber':
                            const vencimentoReceber = parseBrazilianDate(item.vencimento);
                            const hojeReceberAntigo = new Date();
                            matchesFilter = item.tipo === 'C' && vencimentoReceber && vencimentoReceber < hojeReceberAntigo && item.status !== 'pago';
                            break;
                        case 'total-a-receber':
                            const vencimentoTotalReceber = parseBrazilianDate(item.vencimento);
                            const hojeTotalReceber = new Date();
                            matchesFilter = item.tipo === 'C' && item.status !== 'pago';
                            break;
                        case 'total-recebido':
                            matchesFilter = item.tipo === 'C' && item.status === 'pago';
                            break;
                    }
                    
                    if (currentPeriodFilter !== 'all') {
                        const periodDates = getPeriodDates(currentPeriodFilter);
                        return matchesFilter && periodDates ? isDateInPeriod(item.vencimento, periodDates.start, periodDates.end) : matchesFilter;
                    }
                    
                    return matchesFilter;
                });
            }
            
            currentPage = 1;
            updateUI();
        }

        // Fun√ß√£o para limpar filtros
        function clearFilters() {
            currentFilter = null;
            currentPeriodFilter = 'all';
            currentPage = 1;
            filteredData = [...allData];
            
            // Limpa bot√µes ativos
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector('.filter-btn').classList.add('active');
            
            // Limpa inputs customizados
            document.getElementById('start-date').value = '';
            document.getElementById('end-date').value = '';
            document.getElementById('custom-period-inputs').style.display = 'none';
            
            updateUI();
        }

        // Fun√ß√£o para alternar per√≠odo customizado
        function toggleCustomPeriod() {
            const inputs = document.getElementById('custom-period-inputs');
            inputs.style.display = inputs.style.display === 'none' ? 'block' : 'none';
        }

        // Fun√ß√£o para mostrar aba
        function showTab(tabName) {
            // Remove classe active de todas as abas
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Adiciona classe active na aba clicada
            event.target.classList.add('active');
            
            // Por enquanto, s√≥ implementamos a aba geral
            if (tabName === 'geral') {
                document.getElementById('geral').style.display = 'block';
            }
        }

        // Fun√ß√£o para calcular totais
        function calculateTotals() {
            const hoje = new Date();
            const hojeFormatada = hoje.toLocaleDateString('pt-BR');
            
            // Calcula valores considerando tipo (D = negativo, C = positivo)
            const totalPago = filteredData.filter(item => item.status === 'pago').reduce((sum, item) => {
                const valor = item.tipo === 'D' ? -item.valor : item.valor;
                return sum + valor;
            }, 0);
            
            const totalPendente = filteredData.filter(item => item.status === 'pendente').reduce((sum, item) => {
                const valor = item.tipo === 'D' ? -item.valor : item.valor;
                return sum + valor;
            }, 0);
            
            // Total vencido apenas os que est√£o vencidos mas n√£o est√£o pagos
            const totalVencido = filteredData.filter(item => {
                const vencimento = parseBrazilianDate(item.vencimento);
                return vencimento && vencimento < hoje && item.status !== 'pago';
            }).reduce((sum, item) => {
                const valor = item.tipo === 'D' ? -item.valor : item.valor;
                return sum + valor;
            }, 0);
            
            // Total de despesas (tipo D)
            const totalDespesas = filteredData.filter(item => item.tipo === 'D').reduce((sum, item) => sum + item.valor, 0);
            
            // Total de receitas (tipo C)
            const totalReceitas = filteredData.filter(item => item.tipo === 'C').reduce((sum, item) => sum + item.valor, 0);
            
            // Resultado financeiro (receitas - despesas)
            const resultadoFinanceiro = totalReceitas - totalDespesas;
            
            const totalPagoHoje = filteredData.filter(item => 
                item.status === 'pago' && item.dataPagamento === hojeFormatada
            ).reduce((sum, item) => {
                const valor = item.tipo === 'D' ? -item.valor : item.valor;
                return sum + valor;
            }, 0);
            
            // Vencendo hoje apenas os que n√£o est√£o pagos E s√£o do tipo D (despesas)
            const totalVencendoHoje = filteredData.filter(item => {
                const vencimento = parseBrazilianDate(item.vencimento);
                return item.tipo === 'D' && vencimento && vencimento.toDateString() === hoje.toDateString() && item.status !== 'pago';
            }).reduce((sum, item) => {
                return sum + item.valor; // Sempre positivo pois j√° filtramos apenas tipo D
            }, 0);
            
            // C√°lculos espec√≠ficos para Receitas (tipo C)
            const aReceberHoje = filteredData.filter(item => {
                const vencimento = parseBrazilianDate(item.vencimento);
                return item.tipo === 'C' && vencimento && vencimento.toDateString() === hoje.toDateString() && item.status !== 'pago';
            }).reduce((sum, item) => sum + item.valor, 0);
            
            const aReceber = filteredData.filter(item => {
                const vencimento = parseBrazilianDate(item.vencimento);
                return item.tipo === 'C' && vencimento && vencimento < hoje && item.status !== 'pago';
            }).reduce((sum, item) => sum + item.valor, 0);
            
            // Total a receber: todas as receitas n√£o pagas (evita dupla contagem)
            const totalAReceber = filteredData.filter(item => 
                item.tipo === 'C' && item.status !== 'pago'
            ).reduce((sum, item) => sum + item.valor, 0);
            
            const totalRecebido = filteredData.filter(item => 
                item.tipo === 'C' && item.status === 'pago'
            ).reduce((sum, item) => sum + item.valor, 0);
            
            // Atualiza os elementos HTML
            document.getElementById('total-pago').textContent = `R$ ${totalPago.toLocaleString()}`;
            document.getElementById('total-pendente').textContent = `R$ ${totalPendente.toLocaleString()}`;
            document.getElementById('total-vencido').textContent = `R$ ${totalVencido.toLocaleString()}`;
            document.getElementById('total-despesas').textContent = `R$ ${totalDespesas.toLocaleString()}`;
            document.getElementById('total-receitas').textContent = `R$ ${totalReceitas.toLocaleString()}`;
            document.getElementById('total-geral').textContent = `R$ ${resultadoFinanceiro.toLocaleString()}`;
            document.getElementById('total-pago-hoje').textContent = `R$ ${totalPagoHoje.toLocaleString()}`;
            document.getElementById('total-vencendo-hoje').textContent = `R$ ${totalVencendoHoje.toLocaleString()}`;
            
            // Atualiza os novos elementos para Receitas
            document.getElementById('a-receber-hoje').textContent = `R$ ${aReceberHoje.toLocaleString()}`;
            document.getElementById('a-receber').textContent = `R$ ${aReceber.toLocaleString()}`;
            document.getElementById('total-a-receber').textContent = `R$ ${totalAReceber.toLocaleString()}`;
            document.getElementById('total-recebido').textContent = `R$ ${totalRecebido.toLocaleString()}`;
            
            return { 
                totalPago, 
                totalPendente, 
                totalVencido, 
                totalDespesas, 
                totalReceitas, 
                resultadoFinanceiro, 
                totalPagoHoje, 
                totalVencendoHoje,
                aReceberHoje,
                aReceber,
                totalAReceber,
                totalRecebido
            };
        }

        // Fun√ß√£o para atualizar gr√°ficos
        function updateCharts() {
            const totals = calculateTotals();
            
            // Dados para o gr√°fico de linha
            const chartData = filteredData.reduce((acc, item) => {
                const mes = item.vencimento.split('/')[1] || '01';
                const existing = acc.find(x => x.mes === mes);
                if (existing) {
                    existing[item.status] = (existing[item.status] || 0) + item.valor;
                } else {
                    acc.push({ 
                        mes: mes, 
                        pago: item.status === 'pago' ? item.valor : 0,
                        pendente: item.status === 'pendente' ? item.valor : 0,
                        vencido: item.status === 'vencido' ? item.valor : 0
                    });
                }
                return acc;
            }, []);
            
            // Atualiza gr√°fico de linha
            if (lineChart) {
                lineChart.destroy();
            }
            
            const lineCtx = document.getElementById('lineChart').getContext('2d');
            lineChart = new Chart(lineCtx, {
                type: 'line',
                data: {
                    labels: chartData.map(d => `M√™s ${d.mes}`),
                    datasets: [
                        {
                            label: 'Pago',
                            data: chartData.map(d => d.pago),
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Pendente',
                            data: chartData.map(d => d.pendente),
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Vencido',
                            data: chartData.map(d => d.vencido),
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    aspectRatio: 2,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
            
            // Atualiza gr√°fico de pizza
            if (pieChart) {
                pieChart.destroy();
            }
            
            const pieCtx = document.getElementById('pieChart').getContext('2d');
            pieChart = new Chart(pieCtx, {
                type: 'pie',
                data: {
                    labels: ['Pago', 'Pendente', 'Vencido'],
                    datasets: [{
                        data: [totals.totalPago, totals.totalPendente, totals.totalVencido],
                        backgroundColor: ['#10b981', '#f59e0b', '#ef4444'],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    aspectRatio: 1,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return context.label + ': R$ ' + context.parsed.toLocaleString() + ' (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Fun√ß√£o para ordenar dados
        function sortData(data, field, order) {
            return data.sort((a, b) => {
                let aValue = a[field];
                let bValue = b[field];
                
                // Tratamento especial para datas
                if (field === 'vencimento' || field === 'dataPagamento') {
                    aValue = parseBrazilianDate(aValue) || new Date(0);
                    bValue = parseBrazilianDate(bValue) || new Date(0);
                }
                
                // Tratamento especial para valores
                if (field === 'valor') {
                    aValue = parseFloat(aValue) || 0;
                    bValue = parseFloat(bValue) || 0;
                }
                
                // Compara√ß√£o
                if (aValue < bValue) return order === 'asc' ? -1 : 1;
                if (aValue > bValue) return order === 'asc' ? 1 : -1;
                return 0;
            });
        }

        // Fun√ß√£o para atualizar tabela
        function updateTable() {
            // Ordena os dados filtrados
            const sortedData = sortData([...filteredData], sortBy, sortOrder);
            
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const currentData = sortedData.slice(startIndex, endIndex);
            
            const tbody = document.getElementById('data-table-body');
            tbody.innerHTML = '';
            
            currentData.forEach(item => {
                const row = document.createElement('tr');
                const valorFormatado = item.tipo === 'D' ? 
                    `-R$ ${item.valor.toLocaleString()}` : 
                    `+R$ ${item.valor.toLocaleString()}`;
                const valorClass = item.tipo === 'D' ? 'valor-negativo' : 'valor-positivo';
                
                row.innerHTML = `
                    <td>${item.vencimento}</td>
                    <td>${item.descricao}</td>
                    <td>${item.empresa}</td>
                    <td class="${valorClass}">${valorFormatado}</td>
                    <td><span class="status-badge status-${item.status}">${item.status.toUpperCase()}</span></td>
                    <td>${item.dataPagamento || '-'}</td>
                `;
                tbody.appendChild(row);
            });
            
            // Atualiza pagina√ß√£o
            updatePagination();
        }

        // Fun√ß√£o para atualizar pagina√ß√£o
        function updatePagination() {
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, filteredData.length);
            
            const pagination = document.getElementById('pagination');
            const paginationInfo = document.getElementById('pagination-info');
            const paginationControls = document.getElementById('pagination-controls');
            
            if (totalPages > 1) {
                pagination.style.display = 'flex';
                paginationInfo.textContent = `Mostrando ${startIndex + 1}-${endIndex} de ${filteredData.length} registros`;
                
                let controlsHTML = '';
                
                // Bot√£o primeira p√°gina
                controlsHTML += `<button class="page-btn" onclick="goToPage(1)" ${currentPage === 1 ? 'disabled' : ''}>¬´ Primeira</button>`;
                
                // Bot√£o anterior
                controlsHTML += `<button class="page-btn" onclick="goToPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>‚Äπ Anterior</button>`;
                
                // N√∫meros das p√°ginas
                const maxPages = Math.min(7, totalPages);
                let startPage = 1;
                
                if (totalPages > 7) {
                    if (currentPage <= 4) {
                        startPage = 1;
                    } else if (currentPage >= totalPages - 3) {
                        startPage = totalPages - 6;
                    } else {
                        startPage = currentPage - 3;
                    }
                }
                
                for (let i = 0; i < maxPages; i++) {
                    const pageNum = startPage + i;
                    controlsHTML += `<button class="page-btn ${pageNum === currentPage ? 'active' : ''}" onclick="goToPage(${pageNum})">${pageNum}</button>`;
                }
                
                // Bot√£o pr√≥ximo
                controlsHTML += `<button class="page-btn" onclick="goToPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>Pr√≥ximo ‚Ä∫</button>`;
                
                // Bot√£o √∫ltima p√°gina
                controlsHTML += `<button class="page-btn" onclick="goToPage(${totalPages})" ${currentPage === totalPages ? 'disabled' : ''}>√öltima ¬ª</button>`;
                
                paginationControls.innerHTML = controlsHTML;
            } else {
                pagination.style.display = 'none';
            }
        }

        // Fun√ß√£o para ordenar tabela
        function sortTable(field) {
            if (sortBy === field) {
                sortOrder = sortOrder === 'asc' ? 'desc' : 'asc';
            } else {
                sortBy = field;
                sortOrder = 'asc';
            }
            
            // Atualiza indicadores visuais
            document.querySelectorAll('.sort-indicator').forEach(indicator => {
                indicator.classList.remove('active');
                indicator.textContent = '‚Üï';
            });
            
            const currentIndicator = document.getElementById(`sort-${field}`);
            if (currentIndicator) {
                currentIndicator.classList.add('active');
                currentIndicator.textContent = sortOrder === 'asc' ? '‚Üë' : '‚Üì';
            }
            
            currentPage = 1; // Volta para primeira p√°gina ao ordenar
            updateTable();
        }

        // Fun√ß√£o para ir para uma p√°gina
        function goToPage(page) {
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                updateTable();
            }
        }

        // Fun√ß√£o para atualizar contador de filtros
        function updateFilterCount() {
            const countElement = document.getElementById('filter-count');
            const resultadoFinanceiro = filteredData.reduce((sum, item) => {
                const valor = item.tipo === 'D' ? -item.valor : item.valor;
                return sum + valor;
            }, 0);
            countElement.textContent = `${filteredData.length} de ${allData.length} transa√ß√µes (Resultado: R$ ${resultadoFinanceiro.toLocaleString()})`;
        }

        // Fun√ß√£o para atualizar toda a UI
        function updateUI() {
            updateFilterCount();
            updateTable();
            updateCharts();
        }

        // Fun√ß√µes de utilidade para mensagens
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'flex' : 'none';
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('success');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 3000);
        }

        function hideMessages() {
            document.getElementById('error').style.display = 'none';
            document.getElementById('success').style.display = 'none';
        }

        // Dados simulados
        function getMockData() {
            return [
                { 
                    id: '1', 
                    vencimento: '15/07/2025', 
                    descricao: 'DIFEREN√áA DE ALUGUEL BTN 3X6', 
                    empresa: 'FRANCISCO LAURENTINO DA SILVA', 
                    tipo: 'D', 
                    valor: 300, 
                    parcela: '1', 
                    situacao: '1 pago', 
                    dataPagamento: '17/07/2025',
                    status: 'pago'
                },
                { 
                    id: '2', 
                    vencimento: '18/07/2025', 
                    descricao: 'DARF PREVIDENCI√ÅRIO', 
                    empresa: 'DARF', 
                    tipo: 'D', 
                    valor: 612.65, 
                    parcela: '1', 
                    situacao: '', 
                    dataPagamento: '',
                    status: 'vencido'
                },
                { 
                    id: '3', 
                    vencimento: '18/07/2025', 
                    descricao: 'FGTS', 
                    empresa: 'FGTS', 
                    tipo: 'D', 
                    valor: 781.58, 
                    parcela: '1', 
                    situacao: '', 
                    dataPagamento: '',
                    status: 'vencido'
                },
                { 
                    id: '4', 
                    vencimento: '21/07/2025', 
                    descricao: 'ALUGUEL CENTRO', 
                    empresa: 'JOSE GOMES DE SIQUEIRA', 
                    tipo: 'D', 
                    valor: 3500, 
                    parcela: '1', 
                    situacao: '1 pago', 
                    dataPagamento: '21/07/2025',
                    status: 'pago'
                },
                { 
                    id: '5', 
                    vencimento: '25/07/2025', 
                    descricao: 'COFINS CUMULATIVO/ELISLECIO', 
                    empresa: 'RECEITA FEDERAL', 
                    tipo: 'D', 
                    valor: 834.95, 
                    parcela: '1', 
                    situacao: '', 
                    dataPagamento: '',
                    status: 'vencido'
                },
                { 
                    id: '6', 
                    vencimento: '30/07/2025', 
                    descricao: 'INSS', 
                    empresa: 'INSS', 
                    tipo: 'D', 
                    valor: 450.00, 
                    parcela: '1', 
                    situacao: '', 
                    dataPagamento: '',
                    status: 'pendente'
                },
                { 
                    id: '7', 
                    vencimento: '05/08/2025', 
                    descricao: 'ENERGIA EL√âTRICA', 
                    empresa: 'COPEL', 
                    tipo: 'D', 
                    valor: 280.50, 
                    parcela: '1', 
                    situacao: '', 
                    dataPagamento: '',
                    status: 'pendente'
                },
                { 
                    id: '8', 
                    vencimento: '10/08/2025', 
                    descricao: '√ÅGUA E ESGOTO', 
                    empresa: 'SANEPAR', 
                    tipo: 'D', 
                    valor: 120.00, 
                    parcela: '1', 
                    situacao: '', 
                    dataPagamento: '',
                    status: 'pendente'
                },
                { 
                    id: '9', 
                    vencimento: '15/08/2025', 
                    descricao: 'INTERNET', 
                    empresa: 'VIVO', 
                    tipo: 'D', 
                    valor: 89.90, 
                    parcela: '1', 
                    situacao: '', 
                    dataPagamento: '',
                    status: 'pendente'
                },
                { 
                    id: '10', 
                    vencimento: '20/08/2025', 
                    descricao: 'TELEFONE', 
                    empresa: 'OI', 
                    tipo: 'D', 
                    valor: 75.00, 
                    parcela: '1', 
                    situacao: '', 
                    dataPagamento: '',
                    status: 'pendente'
                },
                { 
                    id: '11', 
                    vencimento: '25/08/2025', 
                    descricao: 'SEGURO AUTOM√ìVEL', 
                    empresa: 'PORTO SEGURO', 
                    tipo: 'D', 
                    valor: 350.00, 
                    parcela: '1', 
                    situacao: '', 
                    dataPagamento: '',
                    status: 'pendente'
                },
                { 
                    id: '12', 
                    vencimento: '30/08/2025', 
                    descricao: 'MANUTEN√á√ÉO EQUIPAMENTOS', 
                    empresa: 'TECNICOM', 
                    tipo: 'D', 
                    valor: 500.00, 
                    parcela: '1', 
                    situacao: '', 
                    dataPagamento: '',
                    status: 'pendente'
                },
                { 
                    id: '13', 
                    vencimento: '15/07/2025', 
                    descricao: 'RECEITA DE SERVI√áOS', 
                    empresa: 'CLIENTE A', 
                    tipo: 'C', 
                    valor: 2500.00, 
                    parcela: '1', 
                    situacao: '1 pago', 
                    dataPagamento: '15/07/2025',
                    status: 'pago'
                },
                { 
                    id: '14', 
                    vencimento: '20/07/2025', 
                    descricao: 'VENDA DE PRODUTOS', 
                    empresa: 'CLIENTE B', 
                    tipo: 'C', 
                    valor: 1800.00, 
                    parcela: '1', 
                    situacao: '1 pago', 
                    dataPagamento: '20/07/2025',
                    status: 'pago'
                },
                { 
                    id: '15', 
                    vencimento: '25/07/2025', 
                    descricao: 'CONSULTORIA', 
                    empresa: 'CLIENTE C', 
                    tipo: 'C', 
                    valor: 3200.00, 
                    parcela: '1', 
                    situacao: '', 
                    dataPagamento: '',
                    status: 'pendente'
                },
                { 
                    id: '16', 
                    vencimento: '15/12/2024', 
                    descricao: 'RECEITA ANTIGA', 
                    empresa: 'CLIENTE D', 
                    tipo: 'C', 
                    valor: 1500.00, 
                    parcela: '1', 
                    situacao: '', 
                    dataPagamento: '',
                    status: 'vencido'
                },
                { 
                    id: '17', 
                    vencimento: '20/12/2024', 
                    descricao: 'SERVI√áOS PRESTADOS', 
                    empresa: 'CLIENTE E', 
                    tipo: 'C', 
                    valor: 2800.00, 
                    parcela: '1', 
                    situacao: '1 pago', 
                    dataPagamento: '18/12/2024',
                    status: 'pago'
                },
                { 
                    id: '18', 
                    vencimento: '15/01/2025', 
                    descricao: 'VENDA DE EQUIPAMENTOS', 
                    empresa: 'CLIENTE F', 
                    tipo: 'C', 
                    valor: 4500.00, 
                    parcela: '1', 
                    situacao: '1 pago', 
                    dataPagamento: '10/01/2025',
                    status: 'pago'
                },
                { 
                    id: '19', 
                    vencimento: '15/12/2025', 
                    descricao: 'A RECEBER HOJE', 
                    empresa: 'CLIENTE G', 
                    tipo: 'C', 
                    valor: 1200.00, 
                    parcela: '1', 
                    situacao: '', 
                    dataPagamento: '',
                    status: 'pendente'
                },
                { 
                    id: '20', 
                    vencimento: '10/12/2025', 
                    descricao: 'A RECEBER ANTIGO', 
                    empresa: 'CLIENTE H', 
                    tipo: 'C', 
                    valor: 800.00, 
                    parcela: '1', 
                    situacao: '', 
                    dataPagamento: '',
                    status: 'vencido'
                }
            ];
        }
    </script>
</body>
</html> 